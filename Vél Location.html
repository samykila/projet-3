
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Vél Loction</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
   <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
   <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />
   <link rel="stylesheet" type="text/css" href="css/style.css" />
   <script src="https://kit.fontawesome.com/77339577b5.js" crossorigin="anonymous"></script>
   <script src="Js/canvas.js"></script>
        
  </head>
   <body>
     <header class="menu">
       <div id="image">
       <img id="logo" src="images/velo.png" alt="Logo velo" />
       </div>
      <div id="titre">
        <h1> Vél Location</h1>
      </div>
       <div id="nav">
         <a href="#top">Accueil</a>
         <a href="#map-container">Carte</a>
         <a href="#contact">Contact</a>
      </div>
     </header>
     
      <!--fichier html-->
    <main>
      <div id="macarte"></div>
     <!-- création du formulaire de réservation -->
      <div id="formulaire">
   <form>
     <h2>Description de la station</h2>
       <label for="nom">Station :</label>
        <input type="text" id="station" required/><br/>
      <label for="nom">Adresse :</label>
        <input type="text" id="address" required/><br/>
      <label for="nom"> Disponibilité :</label>
        <input type="text" id="disponibility" required/><br/>
      <label for="nom">Nom :</label>
        <input type="text" id="nom" required/><br/>
      <label for="nom"> Prenom:</label>
        <input type="text" id="prénom" required/><br/>
      <label for="text"> Réserver:</label>
       <input type="submit" value="Réserver" id="reserver"/>
    <div  id="signature">
     <div id="description-canvas">
        <canvas id="canvas" width="20" height="20">
                 Navigateur est incompatible!
        </canvas>
      </div>
        <button  class="btn-reservation">Confirmer la réservation</button>
        <button  class="reset" >Reset signature</button>
     </div>   
   </form>
  </div>
</main>
     <!--fichier javascript-->



     <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
             integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
             crossorigin=""></script>
     <script type='text/javascript' src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>

     <script>
         // on initialise la carte
         var carte = L.map('macarte').setView([45.7578137,4.8320114], 8);

         // on charge les tuiles pour afficher la carte
         L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png',{
             attribution: 'Map data &copy; <a href="https://www.openstreetmap.fr/">OpenStreetMap</a> contributors,<a href="https://creativecommons.org/licenses/by-sa/2.0/"></a>',
             minZoom:1,
             maxZoom:20,
         })

             .addTo(carte);
         // pour determiner un zoom par defaut
         var tableauMarkers =[];

         // on recupère les données
         var request = new XMLHttpRequest();
         request.onreadystatechange = function() {
             if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
                 var response = JSON.parse(this.responseText);
                 console.log(response);

                 // création des clusters
                 var markerClusters = L.markerClusterGroup();
                 // creation des boucles pour les différentes stations
                 for (station in response) {
                     var marker = new L.marker([response[station].position.lat, response[station].position.lng]);// pas de addTo(macarte), l'affichage sera géré par la bibliothèque des clusters

                     const elt = document.getElementById('formulaire');    // On récupère l'élément sur lequel on veut détecter le clic
                     marker.addEventListener('click', function() {
                         lastation= response[station];
                         console.log(lastation.name);   // On écoute l'événement click
                         document.getElementById('station').value = lastation.name;
                         document.getElementById('address').value = lastation.address;
                         document.getElementById('disponibility').value = lastation.disponibility;

                     });
                     markerClusters.addLayer(marker); // Nous ajoutons le marqueur aux groupes
                     tableauMarkers.push(marker);// on ajoute les marqueurs au tableau
                 }

                 var groupe = new L.featureGroup(tableauMarkers);// on ajoute les marqueurs dans un groupe leaflet
                 carte.fitBounds(groupe.getBounds().pad(-5.0)); // on adapte le Zoom
             }
             carte.addLayer(markerClusters); //markerClusters.addTo(carte);
         };
         // envoyer une requëte
         request.open("GET", "https://api.jcdecaux.com/vls/v1/stations?contract=lyon&apiKey=a1bb8a2d6bce79ce80f96e68686478140bfc9616");
         request.setRequestHeader("Content-Type", "application/json");
         request.send();

     </script>



</body> 
</html>